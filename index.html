
<!--
  Copyright (c) 2025 æ¸Ÿé›². All rights reserved.

  Licensed under the TOSSRCU 2025.9 License (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

    https://raw.githubusercontent.com/M3351AN/M3351AN/9e7630a8511b8306c62952ca1a4f1ce0cc5b784a/LICENSE

  -----------------------------------------------------------------------------
  File: index.html
  Author: æ¸Ÿé›² (quq[at]outlook.it)
  Date: 2025-11-02

  Description:
    This file includes functions of web based SPT Fuyu Patcher
  -----------------------------------------------------------------------------
-->

<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="icon.ico">
    <title>SPT Fuyu Patcher - Pure Frontend Solution</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --dark-color: #34495e;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--primary-color);
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
        }
        
        .lang-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .lang-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .content {
            padding: 30px;
        }
        
        .upload-area {
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s;
            cursor: pointer;
            background-color: #f8f9fa;
        }
        
        .upload-area:hover {
            border-color: var(--secondary-color);
            background-color: #f0f7ff;
        }
        
        .upload-area.highlight {
            border-color: var(--secondary-color);
            background-color: #e8f4ff;
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--secondary-color);
            margin-bottom: 15px;
        }
        
        .upload-text {
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-info {
            margin-top: 15px;
            padding: 10px;
            background-color: var(--light-color);
            border-radius: 4px;
            display: none;
        }
        
        .btn {
            background: linear-gradient(90deg, var(--secondary-color), #2980b9);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            display: none;
        }
        
        .status.success {
            background-color: rgba(46, 204, 113, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        
        .status.error {
            background-color: rgba(231, 76, 60, 0.1);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
        }
        
        .features {
            margin-top: 40px;
        }
        
        .features h2 {
            text-align: center;
            margin-bottom: 25px;
            color: var(--dark-color);
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .feature-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 36px;
            margin-bottom: 15px;
            color: var(--secondary-color);
        }
        
        .feature-card h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .feature-card p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
            border-top: 1px solid #ecf0f1;
        }
        
        @media (max-width: 600px) {
            .content {
                padding: 20px;
            }
            
            header {
                padding: 20px;
            }
            
            header h1 {
                font-size: 24px;
            }
            
            .upload-area {
                padding: 30px 15px;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <button class="lang-toggle" id="langToggle">EN/ä¸­æ–‡</button>
            <h1 id="title">SPT Fuyu Patcher</h1>
            <p id="subtitle">åœ¨çº¿ä¿®è¡¥SPTå¯åŠ¨å™¨ ç»•è¿‡æ­£ç‰ˆéªŒè¯</p>
        </header>
        
        <div class="content">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <h3 class="upload-text" id="uploadText">é€‰æ‹©æˆ–æ‹–æ”¾å¯åŠ¨å™¨å¯æ‰§è¡Œæ–‡ä»¶åˆ°æ­¤å¤„</h3>
                <p id="fileSupport">ä¾‹å¦‚ SPT.Launcher.exe</p>
                <input type="file" id="fileInput" class="file-input" accept=".exe">
                <button class="btn" id="selectFileBtn">é€‰æ‹©æ–‡ä»¶</button>
                <div class="file-info" id="fileInfo"></div>
            </div>
            
            <button class="btn" id="patchBtn" disabled>ä¿®è¡¥æ–‡ä»¶</button>
            
            <div class="status" id="status"></div>
            
            <div class="features">
                <h2 id="advantagesTitle">æˆ‘ä»¬çš„ä¼˜åŠ¿</h2>
                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ”’</div>
                        <h3 id="feature1Title">çº¯å‰ç«¯å®ç°</h3>
                        <p id="feature1Desc">æ‰€æœ‰å¤„ç†éƒ½åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­å®Œæˆ - æ— éœ€ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ²¡æœ‰å¤–éƒ¨ä¾èµ–ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ—‘ï¸</div>
                        <h3 id="feature2Title">æ— æ®‹ç•™æ–‡ä»¶</h3>
                        <p id="feature2Desc">æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆåœ¨ä¿®è¡¥å®Œæˆåä¸ä¼šåœ¨æ‚¨çš„ç”µè„‘ä¸­ç•™ä¸‹ä»»ä½•å¤šä½™æ–‡ä»¶ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸ›¡ï¸</div>
                        <h3 id="feature3Title">æ— éœ€æ³¨å†Œè¡¨æƒé™</h3>
                        <p id="feature3Desc">æˆ‘ä»¬ä¸éœ€è¦å±é™©çš„æƒé™å»ä¿®æ”¹æ‚¨çš„ç³»ç»Ÿæ³¨å†Œè¡¨æˆ–è¿›è¡Œç³»ç»Ÿæ›´æ”¹ã€‚</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ğŸŒ</div>
                            <h3 id="feature4Title">æ— éœ€ä¸‹è½½ä»»ä½•å·¥å…·</h3>
                            <p id="feature4Desc">ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œæ— éœ€å®‰è£…æˆ–ä¸‹è½½ä»»ä½•é¢å¤–è½¯ä»¶ã€‚</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
                  <p>SPT Fuyu Patcher Web &copy; 2025 æ¸Ÿé›² | <a href="https://github.com/M3351AN/SPT_Fuyu_Patcher_Web" target="_blank"> GitHub </a></p>
        </footer>
    </div>

    <script>
        // å¤šè¯­è¨€æ–‡æœ¬å®šä¹‰
        const messages = {
            zh: {
                title: "SPT Fuyu åœ¨çº¿ä¿®è¡¥å™¨",
                subtitle: "åœ¨çº¿ä¿®è¡¥SPTå¯åŠ¨å™¨ ç»•è¿‡æ­£ç‰ˆéªŒè¯",
                uploadText: "é€‰æ‹©æˆ–æ‹–æ”¾å¯åŠ¨å™¨å¯æ‰§è¡Œæ–‡ä»¶åˆ°æ­¤å¤„",
                fileSupport: "ä¾‹å¦‚ SPT.Launcher.exe",
                selectFileBtn: "é€‰æ‹©æ–‡ä»¶",
                patchButton: "ä¿®è¡¥æ–‡ä»¶",
                advantagesTitle: "æˆ‘ä»¬çš„ä¼˜åŠ¿",
                feature1Title: "çº¯å‰ç«¯å®ç°",
                feature1Desc: "æ‰€æœ‰å¤„ç†éƒ½åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­å®Œæˆ - æ— éœ€ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ²¡æœ‰å¤–éƒ¨ä¾èµ–ã€‚",
                feature2Title: "æ— æ®‹ç•™æ–‡ä»¶",
                feature2Desc: "æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆåœ¨ä¿®è¡¥å®Œæˆåä¸ä¼šåœ¨æ‚¨çš„ç”µè„‘ä¸­ç•™ä¸‹ä»»ä½•å¤šä½™æ–‡ä»¶ã€‚",
                feature3Title: "æ— éœ€æ³¨å†Œè¡¨æƒé™",
                feature3Desc: "æˆ‘ä»¬ä¸éœ€è¦å±é™©çš„æƒé™å»ä¿®æ”¹æ‚¨çš„ç³»ç»Ÿæ³¨å†Œè¡¨æˆ–è¿›è¡Œç³»ç»Ÿæ›´æ”¹ã€‚",
                feature4Title: "æ— éœ€ä¸‹è½½ä»»ä½•å·¥å…·",
                feature4Desc: "æ— éœ€å®‰è£…ä»»ä½•é¢å¤–è½¯ä»¶æˆ–å·¥å…·ï¼Œæ‰“å¼€ç½‘é¡µå³å¯ä½¿ç”¨ã€‚",
                selectFile: "è¯·é€‰æ‹©æ–‡ä»¶",
                success: "ä¿®è¡¥æˆåŠŸ",
                unknownError: "æœªçŸ¥é”™è¯¯",
                notFound: "æœªæ‰¾åˆ°ç›®æ ‡å­—èŠ‚åºåˆ—",
                alreadyPatched: "æ–‡ä»¶å·²ä¿®è¡¥è¿‡",
                notExe: "ä¸æ˜¯æœ‰æ•ˆçš„å¯æ‰§è¡Œæ–‡ä»¶",
                button: "ä¿®è¡¥æ–‡ä»¶",
                dragDrop: "æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„",
                fileSelected: "å·²é€‰æ‹©æ–‡ä»¶: ",
                langToggle: "EN"
            },
            en: {
                title: "SPT Fuyu Patcher Online",
                subtitle: "bypass EFT live install validate of SPT launcher",
                uploadText: "Select or drag & drop launcher executable file here",
                fileSupport: "i.e., SPT.Launcher.exe",
                selectFileBtn: "Select File",
                patchButton: "Patch File",
                advantagesTitle: "Our Advantages",
                feature1Title: "Pure Frontend Solution",
                feature1Desc: "All processing happens in your browser - no server uploads, no external dependencies.",
                feature2Title: "No Residual Files",
                feature2Desc: "Our solution leaves no extra files on your computer after patching is complete.",
                feature3Title: "No Registry Permissions Needed",
                feature3Desc: "We don't require dangerous permissions to modify your system registry or make system changes.",
                feature4Title: "No Tools to Download",
                feature4Desc: "No need to install any additional software or tools, just open the webpage and use it.",
                selectFile: "Please select a file",
                success: "Patch successful",
                unknownError: "Unknown error",
                notFound: "Target byte sequence not found",
                alreadyPatched: "File already patched",
                notExe: "Not a valid executable file",
                button: "Patch File",
                dragDrop: "Drag & drop file here",
                fileSelected: "File selected: ",
                langToggle: "ä¸­æ–‡"
            }
        };

        function detectUserLanguage() {
            const browserLang = navigator.language || navigator.userLanguage;
            if (browserLang.startsWith("zh")) {
                return "zh";
            } else {
                return "en";
            }
        }

        let currentLang = detectUserLanguage();
        let t = messages[currentLang];

        function updateTexts() {
            document.getElementById('title').textContent = t.title;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('uploadText').textContent = t.uploadText;
            document.getElementById('fileSupport').textContent = t.fileSupport;
            document.getElementById('selectFileBtn').textContent = t.selectFileBtn;
            document.getElementById('patchBtn').textContent = t.patchButton;
            document.getElementById('advantagesTitle').textContent = t.advantagesTitle;
            document.getElementById('feature1Title').textContent = t.feature1Title;
            document.getElementById('feature1Desc').textContent = t.feature1Desc;
            document.getElementById('feature2Title').textContent = t.feature2Title;
            document.getElementById('feature2Desc').textContent = t.feature2Desc;
            document.getElementById('feature3Title').textContent = t.feature3Title;
            document.getElementById('feature3Desc').textContent = t.feature3Desc;
            document.getElementById('feature4Title').textContent = t.feature4Title;
            document.getElementById('feature4Desc').textContent = t.feature4Desc;
            document.getElementById('langToggle').textContent = t.langToggle;
            
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length > 0) {
                document.getElementById('fileInfo').textContent = t.fileSelected + fileInput.files[0].name;
            }
        }

        document.getElementById('langToggle').addEventListener('click', function() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            t = messages[currentLang];
            updateTexts();
        });

        updateTexts();

        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const patchBtn = document.getElementById('patchBtn');
        const selectFileBtn = document.getElementById('selectFileBtn');
        const fileInfo = document.getElementById('fileInfo');
        const statusDiv = document.getElementById('status');

        selectFileBtn.addEventListener('click', function() {
            fileInput.click();
        });

        fileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                fileInfo.textContent = t.fileSelected + file.name;
                fileInfo.style.display = 'block';
                patchBtn.disabled = false;
            }
        });

        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('highlight');
        });

        uploadArea.addEventListener('dragleave', function() {
            uploadArea.classList.remove('highlight');
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('highlight');
            
            if (e.dataTransfer.files.length > 0) {
                const file = e.dataTransfer.files[0];
                fileInput.files = e.dataTransfer.files;
                fileInfo.textContent = t.fileSelected + file.name;
                fileInfo.style.display = 'block';
                patchBtn.disabled = false;
            }
        });

        const pattern = 
            [0x26, 0x15, 0x0B, 0xDE, 0x00, 0x07, 0x16, 0xFE, 0x01, 0x2A];
        const replacement = 
            [0x26, 0x15, 0x0B, 0xDE, 0x00, 0x16, 0x16, 0xFE, 0x01, 0x2A];

        const patternNew = 
            [0xDE, 0x00, 0x11, 0x04, 0x16, 0xFE, 0x01, 0x2A];
        const replacementNew = 
            [0xDE, 0x00, 0x00, 0x16, 0x16, 0xFE, 0x01, 0x2A];

        function findAndReplacePattern(data) {
            if (data.length < 2 || data[0] !== 0x4D || data[1] !== 0x5A) {
                return { success: false, error: "NotExecutable" };
            }
    
            let foundIndex = -1;
            let foundPattern = null;
    
            for (let i = 0; i <= data.length - pattern.length; i++) {
                let found = true;
                for (let j = 0; j < pattern.length; j++) {
                    if (data[i + j] !== pattern[j]) {
                        found = false;
                        break;
                    }
                }
                if (found) {
                    foundIndex = i;
                    foundPattern = "original";
                    break;
                }
            }
    
            if (foundIndex === -1) {
                for (let i = 0; i <= data.length - patternNew.length; i++) {
                    let found = true;
                    for (let j = 0; j < patternNew.length; j++) {
                        if (data[i + j] !== patternNew[j]) {
                            found = false;
                            break;
                        }
                    }
                    if (found) {
                        foundIndex = i;
                        foundPattern = "new";
                        break;
                    }
                }
            }
    
            if (foundIndex !== -1) {
                if (foundPattern === "original") {
                    for (let j = 0; j < replacement.length; j++) {
                        data[foundIndex + j] = replacement[j];
                    }
                } else {
                    for (let j = 0; j < replacementNew.length; j++) {
                        data[foundIndex + j] = replacementNew[j];
                    }
                }
                return { success: true };
            }
    
            for (let i = 0; i <= data.length - replacement.length; i++) {
                let found = true;
                for (let j = 0; j < replacement.length; j++) {
                    if (data[i + j] !== replacement[j]) {
                        found = false;
                        break;
                    }
                }
                if (found) {
                    return { success: false, error: "AlreadyPatched" };
                }
            }
    
            for (let i = 0; i <= data.length - replacementNew.length; i++) {
                let found = true;
                for (let j = 0; j < replacementNew.length; j++) {
                    if (data[i + j] !== replacementNew[j]) {
                        found = false;
                        break;
                    }
                }
                if (found) {
                    return { success: false, error: "AlreadyPatched" };
                }
            }
    
            return { success: false, error: "PatternNotFound" };
        }

        function patchFile() {
            const file = fileInput.files[0];
            
            if (!file) {
                alert(t.selectFile);
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const buffer = e.target.result;
                    const bytes = new Uint8Array(buffer);
                    
                    const result = findAndReplacePattern(bytes);
                    
                    if (result.success) {
                        const blob = new Blob([bytes], {type: 'application/octet-stream'});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'patched_' + file.name;
                        a.click();
                        URL.revokeObjectURL(url);
                        
                        statusDiv.textContent = t.success;
                        statusDiv.className = 'status success';
                        statusDiv.style.display = 'block';
                    } else {
                        let errorMsg = t.unknownError;
                        if (result.error === "PatternNotFound") errorMsg = t.notFound;
                        else if (result.error === "AlreadyPatched") errorMsg = t.alreadyPatched;
                        else if (result.error === "NotExecutable") errorMsg = t.notExe;
                        
                        statusDiv.textContent = 'Error: ' + errorMsg;
                        statusDiv.className = 'status error';
                        statusDiv.style.display = 'block';
                    }
                } catch (error) {
                    statusDiv.textContent = 'Error: ' + error.message;
                    statusDiv.className = 'status error';
                    statusDiv.style.display = 'block';
                }
            };
            reader.readAsArrayBuffer(file);
        }

        patchBtn.addEventListener('click', patchFile);
    </script>
</body>
</html>
